<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grid Game</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Caprasimo&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Savate:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #f9fafb;
      --text-color: #222;
      --cell-bg: #fff;
      --cell-border: #ddd;
      --cell-shadow: rgba(0, 0, 0, 0.05);
      --cell-filled-bg: #81c784;
      --highlight-updown: rgba(129, 199, 132, 0.4);
      --highlight-diagonal: rgba(255, 202, 105, 0.4);
      --highlight-recent: #4caf50;
      --button-bg: #4caf50;
      --button-bg-hover: #388e3c;
      --toast-bg: #333;
      --toast-text: #eee;
      --dark-bg: #121212;
      --dark-text: #eee;
      --dark-cell-bg: #222;
      --dark-cell-border: #444;
      --dark-cell-filled-bg: #81c784;
      --dark-highlight-updown: rgba(100, 255, 150, 0.5);
      --dark-highlight-diagonal: rgba(255, 220, 120, 0.5);
    }

    div {
      white-space: pre-line;
    }

    body {
      font-family: 'Raleway', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }

    body.dark {
      background-color: var(--dark-bg);
      color: var(--dark-text);
    }

    h1 {
      font-family: 'Savate';
      font-weight: 600;
      margin-bottom: 10px;
    }

    #controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 10px;
    }

    label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    }

    select, button {
      font-size: 16px;
      padding: 8px 16px;
      border-radius: 25px;
      border: none;
      background-color: var(--button-bg);
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 6px var(--cell-shadow);
      transition: background-color 0.25s ease;
    }
    select {
      background-color: #eee;
      color: #444;
      cursor: pointer;
      box-shadow: none;
    }
    select:focus {
      outline: none;
      box-shadow: 0 0 6px var(--button-bg);
    }
    button:hover:not(:disabled) {
      background-color: var(--button-bg-hover);
    }
    button:disabled {
      background-color: #ccc;
      cursor: default;
      box-shadow: none;
    }

    #grid {
      display: grid;
      gap: 6px;
      margin-bottom: 15px;
      max-width: 100vw;
    }

    .cell {
      width: 50px;
      height: 50px;
      background: var(--cell-bg);
      border-radius: 12px;
      border: 1px solid var(--cell-border);
      box-shadow: 0 2px 5px var(--cell-shadow);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      color: var(--text-color);
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s, transform 0.15s;
    }
    body.dark .cell {
      background: var(--dark-cell-bg);
      border-color: var(--dark-cell-border);
      color: var(--dark-text);
      box-shadow: none;
    }

    .cell:hover:not(.filled) {
      transform: scale(1.05);
    }

    .filled {
      background-color: var(--cell-filled-bg);
      color: #fff;
      box-shadow: 0 4px 10px rgba(129, 199, 132, 0.7);
      animation: popin 0.25s ease forwards;
    }

    body.dark .filled {
      background-color: var(--dark-cell-filled-bg);
      box-shadow: 0 4px 10px rgba(129, 199, 132, 0.8);
    }

    @keyframes popin {
      0% { transform: scale(0.7); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    .highlight-updown {
      background-color: var(--highlight-updown);
      border-radius: 12px;
      transition: background-color 0.4s;
    }
    .highlight-diagonal {
      background-color: var(--highlight-diagonal);
      border-radius: 12px;
      transition: background-color 0.4s;
    }
    
    body.dark .highlight-updown {
      background-color: var(--dark-highlight-updown);
    }
    body.dark .highlight-diagonal {
      background-color: var(--dark-highlight-diagonal);
    }
    
    .highlight-recent {
      outline: 3px solid var(--highlight-recent);
      outline-offset: 2px;
    }

    .grid-dimmed {
      opacity: 0.5;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }

    .final-score-highlight {
      outline: 4px solid #ff4444 !important;
      outline-offset: 3px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { outline-color: #ff4444; }
      50% { outline-color: #ff6666; }
      100% { outline-color: #ff4444; }
    }

    @keyframes flash {
      0% { background-color: rgba(76, 175, 80, 0.1); }
      50% { background-color: rgba(76, 175, 80, 0.4); }
      100% { background-color: rgba(76, 175, 80, 0.1); }
    }

    .undone {
      background-color: #e57373 !important;
      color: white !important;
      animation: flashRed 0.5s ease;
    }
    @keyframes flashRed {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }

    #status {
      font-size: 18px;
      margin-bottom: 6px;
      min-height: 24px;
    }

    #timer {
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 12px;
      padding: 12px 20px;
      background: linear-gradient(135deg, #4caf50, #45a049);
      color: white;
      border-radius: 25px;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
      transition: all 0.3s ease;
      min-width: 180px;
      text-align: center;
    }

    #timer.warning {
      background: linear-gradient(135deg, #ff9800, #f57c00);
      animation: timerWarning 1s infinite;
    }

    #timer.danger {
      background: linear-gradient(135deg, #f44336, #d32f2f);
      animation: timerDanger 0.5s infinite;
    }

    @keyframes timerWarning {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes timerDanger {
      0% { transform: scale(1); }
      25% { transform: scale(1.1); }
      50% { transform: scale(1); }
      75% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    #gameOverModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: var(--cell-bg);
      padding: 30px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      width: 90%;
    }

    body.dark .modal-content {
      background: var(--dark-cell-bg);
      color: var(--dark-text);
    }

    .modal-content h2 {
      margin-top: 0;
      color: #f44336;
      font-size: 24px;
    }

    .modal-content p {
      font-size: 18px;
      margin: 15px 0;
    }

    .modal-button {
      background: var(--button-bg);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px;
      transition: background-color 0.3s;
    }

    .modal-button:hover {
      background: var(--button-bg-hover);
    }

    /* Responsive */
    @media (max-width: 700px) {
      .cell {
        width: 40px;
        height: 40px;
        font-size: 16px;
      }
      #controls {
        gap: 8px;
      }
      select, button {
        padding: 6px 12px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <h1>GRID GAME</h1>
  <div id="controls">
    <label>
      Grid Size:
      <select id="gridSize"></select>
    </label>
    <button onclick="startGame()">Start Game</button>
    <button id="restartBtn" onclick="startGame()" style="display:none;">Restart</button>
    <button onclick="undoMove()">Undo</button>
    <label class="toggle">
      <input type="checkbox" id="hideNumbers" /> Hide Numbers
    </label>
    <label class="toggle">
      <input type="checkbox" id="hardcoreMode" /> Hardcore Mode
    </label>
    <label class="toggle">
      <input type="checkbox" id="darkMode" onchange="toggleDarkMode(this.checked)" /> Dark Mode
    </label>
  </div>
  <div id="grid"></div>
  <div id="status">Click a square to begin! Undos left: <span id="undoCount">2</span></div>
  <div id="timer">Timer: <span id="moveTimer">15</span>s</div>

  <!-- Game Over Modal -->
  <div id="gameOverModal">
    <div class="modal-content">
      <h2>‚è∞ Time's Up!</h2>
      <p>You ran out of time to make your move!</p>
      <p>Score: <span id="finalScore">0</span> / <span id="totalCells">25</span></p>
      <button class="modal-button" onclick="closeModal()">Try Again</button>
      <button class="modal-button" onclick="startGame(); closeModal();">New Game</button>
    </div>
  </div>

<script>
  const grid = document.getElementById('grid');
  const statusDiv = document.getElementById('status');
  const timerSpan = document.getElementById('moveTimer');
  const undoCountDisplay = document.getElementById('undoCount');
  const hardcoreCheckbox = document.getElementById('hardcoreMode');
  const hideNumbersCheckbox = document.getElementById('hideNumbers');
  const gridSizeSelect = document.getElementById('gridSize');

  const upDownDirs = [[-3,0],[3,0],[0,-3],[0,3]];
  const diagonalDirs = [[-2,-2],[-2,2],[2,-2],[2,2]];

  let size = 5;
  let cells = [], board = [], currentNumber = 1, moveHistory = [], undosLeft = 2;
  let lastCell = null, moveTimer = null, secondsLeft = 15;
  let gameEnded = false;

  // Populate grid size options 5 to 20
  for (let i = 5; i <= 20; i++) {
    const option = document.createElement('option');
    option.value = i;
    option.textContent = `${i}x${i}`;
    if (i === 5) option.selected = true;
    gridSizeSelect.appendChild(option);
  }

  function toggleDarkMode(enabled) {
    document.body.classList.toggle('dark', enabled);
  }

  function isInBounds(r, c) {
    return r >= 0 && r < size && c >= 0 && c < size;
  }

  function clearHighlights() {
    cells.flat().forEach(cell => {
      cell.classList.remove('highlight-updown', 'highlight-diagonal', 'highlight-recent', 'undone');
    });
  }

  function highlightMoves(r, c) {
    clearHighlights();
    for (let [dr, dc] of upDownDirs) {
      const nr = r + dr, nc = c + dc;
      if (isInBounds(nr, nc) && board[nr][nc] === 0)
        cells[nr][nc].classList.add('highlight-updown');
    }
    for (let [dr, dc] of diagonalDirs) {
      const nr = r + dr, nc = c + dc;
      if (isInBounds(nr, nc) && board[nr][nc] === 0)
        cells[nr][nc].classList.add('highlight-diagonal');
    }
  }

  function updateTimer() {
    clearInterval(moveTimer);
    secondsLeft = 15;
    timerSpan.textContent = secondsLeft;
    
    // Reset timer styling
    const timerDiv = document.getElementById('timer');
    timerDiv.classList.remove('warning', 'danger');
    
    moveTimer = setInterval(() => {
      secondsLeft--;
      timerSpan.textContent = secondsLeft;
      
      // Add visual warnings
      if (secondsLeft <= 5 && secondsLeft > 3) {
        timerDiv.classList.add('warning');
        timerDiv.classList.remove('danger');
      } else if (secondsLeft <= 3) {
        timerDiv.classList.add('danger');
        timerDiv.classList.remove('warning');
      }
      
      if (secondsLeft <= 0) {
        clearInterval(moveTimer);
        gameEnded = true;
        showGameOverModal();
      }
    }, 1000);
  }

  function showGameOverModal() {
    const modal = document.getElementById('gameOverModal');
    const finalScore = document.getElementById('finalScore');
    const totalCells = document.getElementById('totalCells');
    
    finalScore.textContent = currentNumber - 1;
    totalCells.textContent = size * size;
    modal.style.display = 'flex';
    
    // Dim the grid and highlight final score
    grid.classList.add('grid-dimmed');
    if (lastCell) {
      lastCell.classList.add('final-score-highlight');
    }
  }

  function closeModal() {
    const modal = document.getElementById('gameOverModal');
    modal.style.display = 'none';
    grid.classList.remove('grid-dimmed');
    if (lastCell) {
      lastCell.classList.remove('final-score-highlight');
    }
    gameEnded = false;
  }

  function checkForNoMovesAndEndGame(r, c) {
    if (hardcoreCheckbox.checked) return;

    const allDirs = [...upDownDirs, ...diagonalDirs];
    for (const [dr, dc] of allDirs) {
      const nr = r + dr;
      const nc = c + dc;
      if (isInBounds(nr, nc) && board[nr][nc] === 0) {
        return; // Found a valid move, so exit
      }
    }

    // If we get here, no moves were found
    clearInterval(moveTimer);
    gameEnded = true;
    statusDiv.textContent = `Game Over! Final Score: ${currentNumber - 1} / ${size * size}`;
    document.getElementById('restartBtn').style.display = 'inline-block';
    
    // Dim the grid and highlight final score
    grid.classList.add('grid-dimmed');
    if (lastCell) {
      lastCell.classList.add('final-score-highlight');
    }
  }

  function cellClick(row, col) {
    if (board[row][col] !== 0) return; // already filled

    let valid = false;

    if (currentNumber === 1) {
      valid = true; // first move always allowed
    } else if (hardcoreCheckbox.checked) {
      valid = board[row][col] === 0; // hardcore mode: any empty cell allowed
    } else {
      valid =
        cells[row][col].classList.contains('highlight-updown') ||
        cells[row][col].classList.contains('highlight-diagonal');
    }

    if (!valid) return;

    // Mark the cell
    board[row][col] = currentNumber;
    if (!hideNumbersCheckbox.checked) cells[row][col].textContent = currentNumber;
    cells[row][col].classList.add('filled');
    cells[row][col].classList.remove('undone');

    if (lastCell) lastCell.classList.remove('highlight-recent');
    cells[row][col].classList.add('highlight-recent');
    lastCell = cells[row][col];

    moveHistory.push([row, col]);
    currentNumber++;
    navigator.vibrate?.(30);
    updateTimer();

    if (currentNumber > size * size) {
      clearInterval(moveTimer);
      statusDiv.textContent = 'üéâ You completed the game!';
      confetti();
      clearHighlights();
      return;
    }

    // Show highlights only if NOT hardcore mode
    if (!hardcoreCheckbox.checked) {
      highlightMoves(row, col);
    } else {
      clearHighlights();
    }

    checkForNoMovesAndEndGame(row, col);
  }

  function undoMove() {
    if (moveHistory.length === 0 || undosLeft <= 0 || hardcoreCheckbox.checked || gameEnded) return;
    const [r, c] = moveHistory.pop();
    board[r][c] = 0;
    cells[r][c].textContent = '';
    cells[r][c].classList.remove('filled');
    cells[r][c].classList.add('undone');
    currentNumber--;
    undosLeft--;
    undoCountDisplay.textContent = undosLeft;
    
    // Remove any game-over styling
    grid.classList.remove('grid-dimmed');
    if (cells[r][c]) {
      cells[r][c].classList.remove('final-score-highlight');
    }
    
    if (moveHistory.length > 0) {
      const [prevR, prevC] = moveHistory[moveHistory.length - 1];
      highlightMoves(prevR, prevC);
    } else {
      clearHighlights();
    }
    updateTimer();
  }

  function buildGrid() {
    grid.innerHTML = '';
    grid.style.gridTemplateColumns = `repeat(${size}, 50px)`;
    grid.style.gridTemplateRows = `repeat(${size}, 50px)`;
    cells = [], board = [];
    for (let r = 0; r < size; r++) {
      cells[r] = [];
      board[r] = [];
      for (let c = 0; c < size; c++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.onclick = () => cellClick(r, c);
        grid.appendChild(cell);
        cells[r][c] = cell;
        board[r][c] = 0;
      }
    }
  }

  function confetti() {
    grid.style.animation = 'flash 0.5s ease-in-out';
    setTimeout(() => grid.style.animation = '', 500);
  }

  function startGame() {
    size = parseInt(gridSizeSelect.value);
    currentNumber = 1;
    moveHistory = [];
    undosLeft = hardcoreCheckbox.checked ? 0 : 2;
    undoCountDisplay.innerText = undosLeft;
    statusDiv.innerText = `Click a square to begin! \n Skip two squares when going right, left, up or down. \n Skip one square when going diagonally. \n See if you can fill the grid!`;
    buildGrid();
    clearInterval(moveTimer);
    clearHighlights();
    gameEnded = false;
    
    // Reset timer styling
    const timerDiv = document.getElementById('timer');
    timerDiv.classList.remove('warning', 'danger');
    
    // Hide restart button and close modal if open
    document.getElementById('restartBtn').style.display = 'none';
    closeModal();
  }

  // Keyboard controls: arrows to move selection, Enter to place number on current cell
  document.addEventListener('keydown', (e) => {
    if (gameEnded || moveHistory.length === 0) return;
    
    let [r, c] = moveHistory[moveHistory.length - 1];
    if (e.key === 'ArrowUp') r = Math.max(0, r - 1);
    if (e.key === 'ArrowDown') r = Math.min(size - 1, r + 1);
    if (e.key === 'ArrowLeft') c = Math.max(0, c - 1);
    if (e.key === 'ArrowRight') c = Math.min(size - 1, c + 1);
    if (e.key === 'Enter') cellClick(r, c);
  });

  startGame();
</script>

  <footer style="margin-top: 20px; font-size: 14px; color: #666;">¬© 2025 Ali A. √únal</footer>

</body>
</html>
