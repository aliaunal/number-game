<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Variable Grid Game</title>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --cell-bg: #f0f0f0;
      --cell-border: #ccc;
      --cell-filled: #90caf9;
      --highlight-updown: lightgreen;
      --highlight-diagonal: khaki;
      --highlight-recent: #42a5f5;
    }
    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #ffffff;
      --cell-bg: #333;
      --cell-border: #666;
      --cell-filled: #2196f3;
      --highlight-updown: #388e3c;
      --highlight-diagonal: #fbc02d;
      --highlight-recent: #64b5f6;
    }
    body {
      font-family: sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 10px;
      transition: background 0.3s, color 0.3s;
    }
    #grid {
      display: grid;
      gap: 2px;
      margin-top: 10px;
    }
    .cell {
      width: 40px;
      height: 40px;
      background-color: var(--cell-bg);
      border: 1px solid var(--cell-border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
      user-select: none;
    }
    .filled {
      background-color: var(--cell-filled);
      animation: fillAnim 0.2s ease-in-out;
    }
    @keyframes fillAnim {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .highlight-updown {
      background-color: var(--highlight-updown);
    }
    .highlight-diagonal {
      background-color: var(--highlight-diagonal);
    }
    .highlight-recent {
      outline: 2px solid var(--highlight-recent);
    }
    .undone {
      background-color: lightcoral !important;
    }
    #controls {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    #status {
      margin-top: 10px;
      font-size: 18px;
    }
    #timer {
      margin-top: 5px;
      font-size: 16px;
    }
    button, select, label {
      padding: 8px;
      font-size: 14px;
    }
    .toggle {
      display: flex;
      align-items: center;
      gap: 5px;
    }
  </style>
</head>
<body>
  <h1>Variable Grid Game</h1>
  <div id="controls">
    <label>
      Grid Size:
      <select id="gridSize"></select>
    </label>
    <button onclick="startGame()">Start Game</button>
    <button onclick="undoMove()">Undo</button>
    <label class="toggle">
      <input type="checkbox" id="hideNumbers" /> Hide Numbers
    </label>
    <label class="toggle">
      <input type="checkbox" id="hardcoreMode" /> Hardcore Mode
    </label>
    <label class="toggle">
      <input type="checkbox" id="darkMode" onchange="toggleDarkMode(this.checked)" /> Dark Mode
    </label>
  </div>
  <div id="grid"></div>
  <div id="status">Click a square to begin! Undos left: <span id="undoCount">2</span></div>
  <div id="timer">Move Timer: <span id="moveTimer">15</span>s</div>

<script>
  const grid = document.getElementById('grid');
  const statusDiv = document.getElementById('status');
  const timerSpan = document.getElementById('moveTimer');
  const undoCountDisplay = document.getElementById('undoCount');
  const hardcoreCheckbox = document.getElementById('hardcoreMode');
  const hideNumbersCheckbox = document.getElementById('hideNumbers');
  const gridSizeSelect = document.getElementById('gridSize');

  const upDownDirs = [[-3,0],[3,0],[0,-3],[0,3]];
  const diagonalDirs = [[-2,-2],[-2,2],[2,-2],[2,2]];

  let size = 5;
  let cells = [], board = [], currentNumber = 1, moveHistory = [], undosLeft = 2;
  let lastCell = null, moveTimer = null, secondsLeft = 15;

  // Populate grid size options 5 to 20
  for (let i = 5; i <= 20; i++) {
    const option = document.createElement('option');
    option.value = i;
    option.textContent = `${i}x${i}`;
    if (i === 5) option.selected = true;
    gridSizeSelect.appendChild(option);
  }

  function toggleDarkMode(enabled) {
    document.body.classList.toggle('dark', enabled);
  }

  function isInBounds(r, c) {
    return r >= 0 && r < size && c >= 0 && c < size;
  }

  function clearHighlights() {
    cells.flat().forEach(cell => {
      cell.classList.remove('highlight-updown', 'highlight-diagonal', 'highlight-recent', 'undone');
    });
  }

  function highlightMoves(r, c) {
    clearHighlights();
    for (let [dr, dc] of upDownDirs) {
      const nr = r + dr, nc = c + dc;
      if (isInBounds(nr, nc) && board[nr][nc] === 0)
        cells[nr][nc].classList.add('highlight-updown');
    }
    for (let [dr, dc] of diagonalDirs) {
      const nr = r + dr, nc = c + dc;
      if (isInBounds(nr, nc) && board[nr][nc] === 0)
        cells[nr][nc].classList.add('highlight-diagonal');
    }
  }

  function updateTimer() {
    clearInterval(moveTimer);
    secondsLeft = 15;
    timerSpan.textContent = secondsLeft;
    moveTimer = setInterval(() => {
      secondsLeft--;
      timerSpan.textContent = secondsLeft;
      if (secondsLeft <= 0) {
        clearInterval(moveTimer);
        alert('⏰ Time\'s up! Make a move faster next time.');
      }
    }, 1000);
  }

  function cellClick(row, col) {
    if (board[row][col] !== 0) return; // already filled

    let valid = false;

    if (currentNumber === 1) {
      valid = true; // first move always allowed
    } else if (hardcoreCheckbox.checked) {
      valid = board[row][col] === 0; // hardcore mode: any empty cell allowed
    } else {
      valid =
        cells[row][col].classList.contains('highlight-updown') ||
        cells[row][col].classList.contains('highlight-diagonal');
    }

    if (!valid) return;

    // Mark the cell
    board[row][col] = currentNumber;
    if (!hideNumbersCheckbox.checked) cells[row][col].textContent = currentNumber;
    cells[row][col].classList.add('filled');
    cells[row][col].classList.remove('undone');

    if (lastCell) lastCell.classList.remove('highlight-recent');
    cells[row][col].classList.add('highlight-recent');
    lastCell = cells[row][col];

    moveHistory.push([row, col]);
    currentNumber++;
    navigator.vibrate?.(30);
    updateTimer();

    if (currentNumber > size * size) {
      clearInterval(moveTimer);
      statusDiv.textContent = '🎉 You completed the game!';
      confetti();
      localStorage.setItem('stage-' + size, 'completed');
      clearHighlights();
      return;
    }

    // Show highlights only if NOT hardcore mode
    if (!hardcoreCheckbox.checked) {
      highlightMoves(row, col);
    } else {
      clearHighlights();
    }
  }

  function undoMove() {
    if (moveHistory.length === 0 || undosLeft <= 0 || hardcoreCheckbox.checked) return;
    const [r, c] = moveHistory.pop();
    board[r][c] = 0;
    cells[r][c].textContent = '';
    cells[r][c].classList.remove('filled');
    cells[r][c].classList.add('undone');
    currentNumber--;
    undosLeft--;
    undoCountDisplay.textContent = undosLeft;
    const [prevR, prevC] = moveHistory.at(-1) || [r, c];
    highlightMoves(prevR, prevC);
    updateTimer();
  }

  function buildGrid() {
    grid.innerHTML = '';
    grid.style.gridTemplateColumns = `repeat(${size}, 40px)`;
    grid.style.gridTemplateRows = `repeat(${size}, 40px)`;
    cells = [], board = [];
    for (let r = 0; r < size; r++) {
      cells[r] = [];
      board[r] = [];
      for (let c = 0; c < size; c++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.onclick = () => cellClick(r, c);
        grid.appendChild(cell);
        cells[r][c] = cell;
        board[r][c] = 0;
      }
    }
  }

  function confetti() {
    grid.style.animation = 'flash 0.5s ease-in-out';
    setTimeout(() => grid.style.animation = '', 500);
  }

  function startGame() {
    size = parseInt(gridSizeSelect.value);
    currentNumber = 1;
    moveHistory = [];
    undosLeft = hardcoreCheckbox.checked ? 0 : 2;
    undoCountDisplay.textContent = undosLeft;
    statusDiv.textContent = `Click a square to begin! Undos left: ${undosLeft}`;
    buildGrid();
    clearInterval(moveTimer);
    clearHighlights();
  }

  // Keyboard controls: arrows to move selection, Enter to place number on current cell
  document.addEventListener('keydown', (e) => {
    if (!lastCell) return;
    let [r, c] = moveHistory.at(-1) || [0, 0];
    if (e.key === 'ArrowUp') r = Math.max(0, r - 1);
    if (e.key === 'ArrowDown') r = Math.min(size - 1, r + 1);
    if (e.key === 'ArrowLeft') c = Math.max(0, c - 1);
    if (e.key === 'ArrowRight') c = Math.min(size - 1, c + 1);
    if (e.key === 'Enter') cellClick(r, c);
  });

  startGame();
</script>

  <footer style="margin-top: 20px; font-size: 14px; color: #666;">© 2025 Ali A. Ünal</footer>

</body>
</html>
